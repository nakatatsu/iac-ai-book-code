# 開発・運用ガイドライン

## 1. セットアップ

- [別紙](documents/setup.md)を参考に環境をセットアップします。

## 2. 設計・コーディング

### 2.1 作業の順番

作業の順番は下記を基本とします。

1. モジュール単体で構築・テストを実施する
2. それぞれのモジュールを結合して各環境（e.g., development, production)を作成する
3. アプリケーション本体やスタブなどを用いて疎通を確認する

原則としてリソースはモジュールで作成します。各環境間で再利用して環境差異を最小限に抑えるためです。
テストも含め、モジュール単位で行えることはモジュール単位で行います。

### 2.2 コード作成

1. **モジュール説明書の作成**: モジュールの概要を記載した説明書(`readme.md`)を作成し、モジュールディレクトリに格納します。
2. **モジュール仕様書の作成**: 説明書の内容とインフラ設計ポリシーを踏まえて、モジュール仕様書(`specification.md`または`[項目名]_requirements.md`)を作成し、モジュールディレクトリに格納します。
3. **Terraformコードの生成とテスト**: モジュール仕様書の内容とコーディングガイドラインをもとにTerraformのコードを作成します。この際、コーディングとテストおよび修正をモジュール単位で実施します。
4. **コードからのドキュメント生成(必要な場合)**: コードを先に直した場合、仕様書を後追いさせます。必要な場合としていますが、テスト時にAIがコードだけ直すためかなりの高確率で起こります。
5. **後片付け**: テスト用に作成したリソースや一時ファイル等を削除します。

#### 2.2.1 テストと修正

- **`terraform fmt`**を使用してコードを整形します。
- **`terraform validate`**を使用して構文チェックを実施します。
- **`tflint`**を使用してリントチェックを実施します。
- **`checkov`**を使用して静的解析を行い、セキュリティやコンプライアンスの問題を検出します。
- **`terraform plan`**を実行し、作成予定のリソースを確認します。
- **`terraform apply`**を実行し、実際にリソースが作成できるか確認します。
- **`terraform test`**も必要に応じて利用できます。

## 3. 運用

### 3.1 ログと監査
- **トレーサビリティの確保**: 本番環境およびstaging環境においてはCI/CDによるリリースを徹底し、Terraform操作に関するログを必ず保存します。
- **ローカル操作の禁止**: [NG] 本番環境のリソースに対して`terraform apply`または`terraform destroy`をローカル環境からかけてはいけません。


